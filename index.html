<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>XR Photo Portfolio</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
    <script src="https://aframe.io/releases/1.2.0/aframe-inspector.min.js"></script>
    <a-scene>
        <a-sky src="assets/360.png"></a-sky>
        <a-light type="directional" castShadow="true" position="5 5 5"></a-light>

        <!-- 左手のコントローラ -->
        <a-entity oculus-touch-controls="hand: left"></a-entity>
        <!-- 右手のコントローラ -->
        <a-entity oculus-touch-controls="hand: right"></a-entity>

        <!-- マスク用の平面エンティティを追加 -->
        <a-entity id="mask-right" position="3.9 1.6 -1.89">
            <a-plane width="6" height="5" color="black" opacity="0"></a-plane>
        </a-entity>

        <a-entity id="mask-left" position="-3.9 1.6 -1.89">
            <a-plane width="6" height="5" color="black" opacity="0"></a-plane>
        </a-entity>

        <a-assets>
          <img id="cubeTexture" src="./assets/a.png">
        </a-assets>
        <!-- キューブ型の部屋の定義 -->
        <a-box position="0 5 0" width="10" height="10" depth="10" 
           material="src: #cubeTexture; repeat: 1 1" side="back"></a-box>

        <!-- -->
        <a-entity id="window" position="0 1.6 -2">
            <a-plane id="window-plane" width="2" height="1.25" material="opacity: 0.5; color: #030303" border-radius="0.2" receiveShadow="true"></a-plane>
        </a-entity>

        <a-assets>
            <!-- ここに写真のアセットを追加します -->
            <img id="photo1" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg" castShadow="true">
            <img id="photo2" src="https://live.staticflickr.com/65535/53324907283_21ad32570c_h.jpg" castShadow="true">
            <img id="photo3" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg" castShadow="true">
            <img id="photo4" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg" castShadow="true">
            <img id="photo5" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg" castShadow="true">
            <img id="photo6" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg" castShadow="true">
            <img id="photo7" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg" castShadow="true">
            <img id="photo8" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg" castShadow="true">
            <img id="photo9" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg" castShadow="true">
            <img id="photo10" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg" castShadow="true">
            <!-- 他の写真も同様に追加 -->
        </a-assets>

        <!-- カメラ -->
        <a-camera>
            <a-cursor></a-cursor>
        </a-camera>

        <script>
            AFRAME.registerComponent('scroll-photos', {
                schema: {
                    speed: {type: 'number', default: 1}
                },

                init: function() {
                    this.el.sceneEl.addEventListener('axismove', this.onAxisMove.bind(this));
                    this.xPosition = 0;
                },

                onAxisMove: function(evt) {
                    var x = evt.detail.axis[2]; // Oculus Touchの右ジョイスティックのx軸
                    this.xPosition += x * this.data.speed;
                    this.updatePhotoPositions();
                },

                updatePhotoPositions: function() {
                    var photoEls = this.el.querySelectorAll('a-image');
                    photoEls.forEach((photoEl, i) => {
                        var originalX = -5 + i * 1.5; // 元々のX座標
                        photoEl.setAttribute('position', { x: originalX + this.xPosition, y: 0, z: 0.1 });
                    });
                }
            });

            document.addEventListener('DOMContentLoaded', function() {
                var sceneEl = document.querySelector('a-scene');
                sceneEl.addEventListener('loaded', function() {
                    var windowEntity = document.getElementById('window');
                    windowEntity.setAttribute('scroll-photos', ''); // スクロールコンポーネントを追加

                    // <a-assets>内のすべての<img>要素のIDを取得
                    var photoIds = Array.from(document.querySelectorAll('a-assets img')).map(img => img.id);

                    // 写真の生成と配置
                    photoIds.forEach((imgId, i) => {
                        var photoEl = document.createElement('a-image');
                        photoEl.setAttribute('src', '#' + imgId);
                        var xPosition = -5 + i * 1.5;
                        photoEl.setAttribute('position', { x: xPosition, y: 0, z: 0.1 });

                        setPhotoAspectRatio(photoEl, imgId);
                        windowEntity.appendChild(photoEl);
                    });
                });

                function setPhotoAspectRatio(photoElement, imgId) {
                    var img = document.getElementById(imgId);
                    var tempImg = new Image();
                    tempImg.onload = function() {
                        var aspectRatio = tempImg.width / tempImg.height;
                        photoElement.setAttribute('width', aspectRatio);
                        photoElement.setAttribute('height', 1);
                    };
                    tempImg.src = img.src;
                }
            });
        </script>
    </a-scene>

</body>
</html>
