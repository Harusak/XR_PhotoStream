<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>VR Photo Portfolio</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
    <a-scene>
        <!-- 左手のコントローラ -->
        <a-entity oculus-touch-controls="hand: left"></a-entity>
        <!-- 右手のコントローラ -->
        <a-entity oculus-touch-controls="hand: right"></a-entity>

        <a-assets>
          <img id="cubeTexture" src="./assets/a.png">
        </a-assets>
        <!-- キューブ型の部屋の定義 -->
        <a-box position="0 5 0" width="10" height="10" depth="10" 
           material="src: #cubeTexture; repeat: 1 1" side="back"></a-box>

        <a-assets>
            <!-- ここに写真のアセットを追加します -->
            <img id="photo1" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <img id="photo2" src="https://live.staticflickr.com/65535/53324907283_21ad32570c_h.jpg">
            <img id="photo3" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <img id="photo4" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <img id="photo5" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <img id="photo6" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <img id="photo7" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <img id="photo8" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <img id="photo9" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <img id="photo10" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <!-- 他の写真も同様に追加 -->
        </a-assets>

        <!-- 写真が回転する円環 -->
        <a-entity id="photo-circle" rotation="0 0 0"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 20000; easing: linear">
        </a-entity>

        <!-- カメラ -->
        <a-camera>
            <a-cursor></a-cursor>

            <!-- キャンバス -->
            <a-entity id="photo-canvas" position="0 0 -1">
                <a-plane id="canvas-plane" width="3" height="2" color="#FFF"></a-plane>
                <!-- 歓迎メッセージ -->
                <a-text id="welcome-message" value="Welcome" align="center" position="0 0.5 0" scale="2 2 2"></a-text>

                <!-- クローズボタン -->
                <a-plane id="close-button" position="0 -0.5 0" width="1" height="0.5" color="red">
                    <a-text value="Close" align="center"></a-text>
                </a-plane>
            </a-entity>
        </a-camera>

    </a-scene>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var photoCanvas = document.getElementById('photo-canvas');
        var closeButton = document.getElementById('close-button');
        var welcomeMessage = document.getElementById('welcome-message');

        // 初期状態では歓迎メッセージを表示
        photoCanvas.setAttribute('visible', true);
        welcomeMessage.setAttribute('visible', true);

        // クローズボタンのクリックイベントリスナー
        closeButton.addEventListener('click', function() {
            photoCanvas.setAttribute('visible', false);
        });

        var radius = 2.5;
        var photoCircle = document.getElementById('photo-circle');
        var photos = []; // 写真要素を格納する配列
        var zoomedPhoto = null; // 拡大表示された写真
        var isAnimating = true; // 写真が回転しているかどうか

        // 写真のIDを配列に格納
        var photoIds = [];
        var numberOfPhotos = 10; // 写真の枚数
        for (var i = 1; i <= numberOfPhotos; i++) {
            photoIds.push('photo' + i);
        }

        photoIds.forEach(function(photoId, i) {
            var theta = (i / photoIds.length) * Math.PI * 2;
            var x = radius * Math.cos(theta);
            var y = 1.5;
            var z = radius * Math.sin(theta);

            var photoEl = document.createElement('a-image');
            photoEl.setAttribute('src', '#' + photoId);
            photoEl.setAttribute('position', {x: x, y: y, z: z});

            setPhotoAspectRatio(photoEl, photoId);

            // クリックイベントリスナーを追加
            photoEl.addEventListener('click', function() {
                var photoSrc = this.getAttribute('src');
                showPhotoOnCanvas(photoSrc);
            });

            photoCircle.appendChild(photoEl);
            photos.push(photoEl);
        });

        function showPhotoOnCanvas(photoSrc) {
            var photoCanvas = document.getElementById('photo-canvas');
            var canvasPlane = document.getElementById('canvas-plane');
            var camera = document.querySelector('a-camera');

            var welcomeMessage = document.getElementById('welcome-message');
            welcomeMessage.setAttribute('visible', false); // 歓迎メッセージを非表示に

            // キャンバスをカメラの目の前に配置
            photoCanvas.object3D.position.setFromMatrixPosition(camera.object3D.matrixWorld);
            photoCanvas.object3D.rotation.copy(camera.object3D.rotation);

            canvasPlane.setAttribute('material', 'src', photoSrc); // 写真をキャンバスに設定
            photoCanvas.setAttribute('visible', true); // キャンバスを表示

            stopPhotosAnimation(); // 写真の回転を停止
            zoomedPhoto = photoSrc; // 拡大表示された写真を記録
        }

        function setPhotoAspectRatio(photoElement, imgId) {
            var img = document.getElementById(imgId);
            var src = img.src; // 実際の画像ファイルのパスを取得

            var tempImg = new Image();
            tempImg.onload = function() {
                var aspectRatio = tempImg.width / tempImg.height;
                photoElement.setAttribute('width', aspectRatio);
                photoElement.setAttribute('height', 1);
            };
            tempImg.src = src;
        }

        function updatePhotos() {
            photos.forEach(function(photo) {
                var camera = document.querySelector('[camera]').object3D.position;
                var target = new THREE.Vector3(camera.x, camera.y, camera.z);
                photo.object3D.lookAt(target);
            });
        }

        function stopPhotosAnimation() {
            if (isAnimating) {
                var photoCircle = document.getElementById('photo-circle');
                photoCircle.removeAttribute('animation');
                isAnimating = false;
            }
        }

        function startPhotosAnimation() {
            if (!isAnimating) {
                var photoCircle = document.getElementById('photo-circle');
                photoCircle.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 20000; easing: linear');
                isAnimating = true;
            }
        }

        function resetPhotos() {
            photos.forEach(function(photo, i) {
                var theta = (i / photos.length) * Math.PI * 2;
                var x = radius * Math.cos(theta);
                var y = 1.5;
                var z = radius * Math.sin(theta);
                photo.setAttribute('position', {x: x, y: y, z: z});
                photo.setAttribute('scale', {x: 1, y: 1, z: 1});
            });

            var photoCanvas = document.getElementById('photo-canvas');
            photoCanvas.setAttribute('visible', false); // キャンバスを非表示に
        }

        AFRAME.registerComponent('photo-look-at', {
            tick: function() {
                updatePhotos();
            }
        });

        photoCircle.setAttribute('photo-look-at', '');
      });
    </script>

</body>
</html>
