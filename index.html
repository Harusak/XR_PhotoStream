<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>XR Photo Portfolio</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
    <a-scene>
        <!-- 左手のコントローラ -->
        <a-entity oculus-touch-controls="hand: left"></a-entity>
        <!-- 右手のコントローラ -->
        <a-entity oculus-touch-controls="hand: right"></a-entity>

        <a-assets>
          <img id="cubeTexture" src="./assets/a.png">
        </a-assets>
        <!-- キューブ型の部屋の定義 -->
        <a-box position="0 5 0" width="10" height="10" depth="10" 
           material="src: #cubeTexture; repeat: 1 1" side="back"></a-box>

        <!-- -->
        <a-entity id="window" position="0 1.6 -2.1">
            <a-plane id="window-plane" width="4" height="3" color="gray"></a-plane>
        </a-entity>

        <a-assets>
            <!-- ここに写真のアセットを追加します -->
            <img id="photo1" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <img id="photo2" src="https://live.staticflickr.com/65535/53324907283_21ad32570c_h.jpg">
            <img id="photo3" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <img id="photo4" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <img id="photo5" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <img id="photo6" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <img id="photo7" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <img id="photo8" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <img id="photo9" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <img id="photo10" src="https://live.staticflickr.com/65535/53098018469_eb8b162a71_k.jpg">
            <!-- 他の写真も同様に追加 -->
        </a-assets>

        <!-- カメラ -->
        <a-camera>
            <a-cursor></a-cursor>
        </a-camera>

    </a-scene>

    <script>
    AFRAME.registerComponent('fade-edge', {
        tick: function() {
            var windowPlaneEl = document.getElementById('window-plane');
            var windowPosition = windowPlaneEl.object3D.position;
            var windowWidth = windowPlaneEl.getAttribute('width');

            // ウィンドウの左右端の座標を計算
            var leftEdge = windowPosition.x - windowWidth / 2 - 0.1;
            var rightEdge = windowPosition.x + windowWidth / 2 + 0.1;

            var photos = document.querySelectorAll('[fade-edge]');
            photos.forEach(function(photo) {
                var photoPosition = photo.object3D.position.x;

                // ウィンドウの範囲外にある場合、透明度を下げる
                if (photoPosition < leftEdge || photoPosition > rightEdge) {
                    var opacity = Math.max(0, 1 - Math.abs(photoPosition - windowPosition.x) / 0.1);
                    photo.setAttribute('material', 'opacity', opacity);
                } else {
                    // ウィンドウの範囲内にある場合、透明度を1に設定
                    photo.setAttribute('material', 'opacity', 1);
                }
            });
        }
    });


    document.addEventListener('DOMContentLoaded', function() {
        var windowEntity = document.getElementById('window');
        var photoSpacing = 1.5; // 写真間の間隔
        var startOffset = 5; // 最初の写真の開始位置

        // <a-assets>内のすべての<img>要素のIDを取得
        var photoIds = Array.from(document.querySelectorAll('a-assets img')).map(function(img) {
            return img.id;
        });

        // 写真の生成と配置
        for (var i = 0; i < photoIds.length; i++) {
            var photoEl = document.createElement('a-image');
            photoEl.setAttribute('src', '#' + photoIds[i]);
            var xPosition = startOffset + i * photoSpacing;
            photoEl.setAttribute('position', { x: xPosition, y: 1.6, z: -2.1 });

            // 写真のアニメーション設定
            photoEl.setAttribute('animation', {
                property: 'position',
                to: { x: xPosition - 10, y: 1.6, z: -2.1 },
                loop: true,
                dur: 10000,
                easing: 'linear'
            });

            photoEl.setAttribute('fade-edge', ''); // fade-edgeコンポーネントを追加
            windowEntity.appendChild(photoEl);
        }
    });
    </script>


</body>
</html>
